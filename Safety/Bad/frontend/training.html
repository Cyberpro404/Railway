<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rail Safety Monitor - ML Training</title>
  
  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="app.css">
  <link rel="stylesheet" href="ml-styles.css">
  
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --success-color: #4cc9f0;
      --warning-color: #f8961e;
      --danger-color: #f94144;
      --dark-color: #1a1a2e;
      --light-color: #f8f9fa;
    }
    
    body {
      background-color: #0f172a;
      color: #e2e8f0;
    }
    
    .card {
      background-color: #1e293b;
      border: 1px solid #334155;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .card-header {
      background-color: #1e293b;
      border-bottom: 1px solid #334155;
    }
    
    .table {
      color: #e2e8f0;
    }
    
    .table-hover > tbody > tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    .form-control, .form-select {
      background-color: #1e293b;
      border: 1px solid #334155;
      color: #e2e8f0;
    }
    
    .form-control:focus, .form-select:focus {
      background-color: #1e293b;
      color: #e2e8f0;
      border-color: #4f46e5;
      box-shadow: 0 0 0 0.25rem rgba(79, 70, 229, 0.25);
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .btn-primary:hover {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
    }
    
    .status-badge {
      padding: 0.35em 0.65em;
      font-size: 0.75em;
      font-weight: 600;
      border-radius: 0.375rem;
    }
    
    .status-badge.trained {
      background-color: rgba(34, 197, 94, 0.1);
      color: #22c55e;
    }
    
    .status-badge.training {
      background-color: rgba(234, 179, 8, 0.1);
      color: #eab308;
      animation: pulse 2s infinite;
    }
    
    .status-badge.error {
      background-color: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Rail Safety Monitor</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="training.html">ML Training</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="gandiva.html">Gandiva</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container-fluid py-4">
    <!-- Status Alerts -->
    <div id="statusAlert" class="alert alert-dismissible fade d-none" role="alert">
      <span id="alertMessage"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Model Training Section -->
    <div class="row g-4 mb-4">
      <!-- Model Status Card -->
      <div class="col-12 col-xl-8">
        <div class="card h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="bi bi-robot me-2"></i>Model Training</h5>
            <div class="d-flex">
              <button id="refreshTrainingBtn" class="btn btn-sm btn-outline-light me-2" title="Refresh">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
              <button id="trainModelBtn" class="btn btn-sm btn-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="Start model training">
                <i class="bi bi-gear-wide-connected me-1"></i> Train Model
              </button>
            </div>
          </div>
          <div class="card-body">
            <div id="modelCard">
              <div class="d-flex flex-column align-items-center justify-content-center py-4">
                <div class="spinner-border text-primary mb-3" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <h5 class="mb-2">Loading Model Information</h5>
                <p class="text-muted mb-0">Please wait while we load the model details...</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Training Stats Card -->
      <div class="col-12 col-xl-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Training Statistics</h5>
          </div>
          <div class="card-body">
            <div class="d-flex flex-column h-100 justify-content-center">
              <div class="text-center mb-4">
                <div class="display-5 fw-bold text-primary mb-1" id="modelAccuracy">--</div>
                <div class="text-muted small">Model Accuracy</div>
              </div>
              <div class="row g-3">
                <div class="col-6">
                  <div class="p-3 bg-dark bg-opacity-25 rounded-3 text-center">
                    <div class="h4 mb-1" id="trainingSamples">0</div>
                    <div class="text-muted small">Training Samples</div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="p-3 bg-dark bg-opacity-25 rounded-3 text-center">
                    <div class="h4 mb-1" id="lastTrained">--</div>
                    <div class="text-muted small">Last Trained</div>
                  </div>
                </div>
              </div>
              <div class="progress mt-4" style="height: 8px;">
                <div id="trainingProgress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
              </div>
              <div class="text-end mt-2">
                <small class="text-muted">Training Progress</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Training Data Section -->
    <div class="row g-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex flex-column flex-md-row justify-content-between align-items-md-center">
            <div class="d-flex align-items-center mb-2 mb-md-0">
              <i class="bi bi-database me-2"></i>
              <h5 class="mb-0">Training Dataset</h5>
              <span class="badge bg-primary-soft ms-3" id="sampleCount">0 samples</span>
            </div>
            <div class="d-flex flex-wrap gap-2">
              <div class="input-group input-group-sm" style="max-width: 250px;">
                <span class="input-group-text bg-dark border-dark"><i class="bi bi-search"></i></span>
                <input type="text" id="searchSamples" class="form-control form-control-sm" placeholder="Search samples...">
              </div>
              <div class="btn-group" role="group">
                <button id="exportTrainingBtn" class="btn btn-sm btn-outline-light" data-bs-toggle="tooltip" title="Export selected samples">
                  <i class="bi bi-download me-1"></i> Export
                </button>
                <button id="deleteSamplesBtn" class="btn btn-sm btn-outline-danger" disabled data-bs-toggle="tooltip" title="Delete selected samples">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
              <button id="captureTrainingBtn" class="btn btn-sm btn-primary">
                <i class="bi bi-plus-lg me-1"></i> Capture Sample
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="bg-dark bg-opacity-25">
                  <tr>
                    <th width="50" class="ps-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAllSamples">
                      </div>
                    </th>
                    <th>ID <i class="bi bi-arrow-down-up text-muted small ms-1"></i></th>
                    <th>Timestamp <i class="bi bi-arrow-down-up text-muted small ms-1"></i></th>
                    <th>Z-Axis (mm/s) <i class="bi bi-arrow-down-up text-muted small ms-1"></i></th>
                    <th>X-Axis (mm/s) <i class="bi bi-arrow-down-up text-muted small ms-1"></i></th>
                    <th>Temp (Â°C) <i class="bi bi-arrow-down-up text-muted small ms-1"></i></th>
                    <th>Label <i class="bi bi-arrow-down-up text-muted small ms-1"></i></th>
                    <th class="text-end pe-3">Actions</th>
                  </tr>
                </thead>
                <tbody id="trainingSamplesTable">
                  <!-- Will be populated by JavaScript -->
                  <tr>
                    <td colspan="8" class="text-center py-4">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                      <p class="mt-2 mb-0">Loading training data...</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mt-3">
              <div class="text-muted small" id="trainingPaginationInfo">
                Showing 0 to 0 of 0 entries
              </div>
              <nav>
                <ul class="pagination pagination-sm mb-0">
                  <li class="page-item disabled" id="trainingPrevBtn">
                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                  </li>
                  <li class="page-item active"><span class="page-link">1</span></li>
                  <li class="page-item disabled" id="trainingNextBtn">
                    <a class="page-link" href="#">Next</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Capture Sample Modal -->
  <div class="modal fade" id="captureModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow">
        <div class="modal-header bg-dark bg-opacity-10 border-0">
          <h5 class="modal-title d-flex align-items-center">
            <i class="bi bi-camera me-2 text-primary"></i>
            <span>Capture Training Sample</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="captureStep1">
            <div class="text-center mb-4">
              <div class="position-relative d-inline-block mb-3">
                <div class="bg-primary bg-opacity-10 rounded-circle p-4">
                  <i class="bi bi-camera text-primary" style="font-size: 2.5rem;"></i>
                </div>
                <div class="position-absolute top-0 start-100 translate-middle">
                  <span class="badge rounded-pill bg-danger">Live</span>
                </div>
              </div>
              <h5>Ready to Capture Sample</h5>
              <p class="text-muted">Current sensor readings will be captured as a training sample</p>
            </div>
            
            <div class="mb-4">
              <label class="form-label fw-semibold">Sample Label <span class="text-danger">*</span></label>
              <div class="d-flex flex-wrap gap-2 mb-3">
                <input type="radio" class="btn-check" name="sampleLabel" id="labelNormal" value="normal" autocomplete="off" checked>
                <label class="btn btn-outline-success" for="labelNormal">
                  <i class="bi bi-check-circle me-1"></i> Normal
                </label>
                
                <input type="radio" class="btn-check" name="sampleLabel" id="labelWarning" value="warning" autocomplete="off">
                <label class="btn btn-outline-warning" for="labelWarning">
                  <i class="bi bi-exclamation-triangle me-1"></i> Warning
                </label>
                
                <input type="radio" class="btn-check" name="sampleLabel" id="labelCritical" value="critical" autocomplete="off">
                <label class="btn btn-outline-danger" for="labelCritical">
                  <i class="bi bi-exclamation-octagon me-1"></i> Critical
                </label>
              </div>
              
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="sampleLabelCustom" placeholder="Custom label (optional)">
                <label for="sampleLabelCustom">Custom label (optional)</label>
              </div>
              
              <div class="form-floating">
                <textarea class="form-control" placeholder="Add notes about this sample" id="sampleNotes" style="height: 100px"></textarea>
                <label for="sampleNotes">Notes (optional)</label>
              </div>
            </div>
            
            <div class="alert alert-primary d-flex align-items-center">
              <i class="bi bi-info-circle-fill me-2"></i>
              <div>
                <small class="d-block">Ensure the rail condition matches the selected label before capturing.</small>
                <small class="d-block mt-1">For best results, capture multiple samples for each condition.</small>
              </div>
            </div>
          </div>
          
          <div id="captureStep2" class="text-center d-none">
            <div class="py-4">
              <div class="spinner-border text-primary mb-3" role="status" style="width: 4rem; height: 4rem;">
                <span class="visually-hidden">Capturing...</span>
              </div>
              <h5>Capturing Sample</h5>
              <p class="text-muted mb-0">Please wait while we capture sensor data...</p>
              <div class="progress mt-3" style="height: 6px;">
                <div class="progress-bar progress-bar-striped progress-bar-animated w-100"></div>
              </div>
            </div>
          </div>
          
          <div id="captureSuccess" class="text-center d-none">
            <div class="py-4">
              <div class="bg-success bg-opacity-10 d-inline-flex align-items-center justify-content-center rounded-circle mb-3" style="width: 80px; height: 80px;">
                <i class="bi bi-check2-circle text-success" style="font-size: 2.5rem;"></i>
              </div>
              <h5>Sample Captured Successfully!</h5>
              <p class="text-muted">Your training sample has been saved to the dataset.</p>
              <div class="d-flex justify-content-center gap-2 mt-4">
                <button type="button" class="btn btn-outline-secondary" id="captureAnother">
                  <i class="bi bi-plus-circle me-1"></i> Capture Another
                </button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                  <i class="bi bi-check-lg me-1"></i> Done
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer bg-light">
          <button type="button" class="btn btn-link text-muted" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary px-4" id="confirmCapture">
            <i class="bi bi-camera me-1"></i> Capture Sample
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Training Progress Modal -->
  <div class="modal fade" id="trainingProgressModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Training Model</h5>
        </div>
        <div class="modal-body">
          <div id="trainingProgress">
            <div class="progress mb-3" style="height: 24px;">
              <div id="trainingProgressFill" class="progress-bar progress-bar-striped progress-bar-animated" 
                   role="progressbar" style="width: 0%"></div>
            </div>
            <div class="d-flex justify-content-between">
              <span id="trainingProgressText">Preparing data...</span>
              <span id="trainingPercent">0%</span>
            </div>
          </div>
          <div id="trainingResults" style="display: none;">
            <h6 class="mb-3">Training Complete</h6>
            <div class="d-flex justify-content-around text-center" id="trainingMetrics">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="closeTrainingBtn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Application Scripts -->
  <script src="app.js"></script>
  <script src="training.js"></script>
  
  <script>
    // Initialize the training page when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      initTraining();
    });
  </script>
</body>
</html>
